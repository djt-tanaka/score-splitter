# 主要機能

## 1. 家計管理（収入・支出・繰越）

月単位で収入・支出・繰越データを管理します。

### データ入力

- **収入**: 給与、副収入など（正の値）
- **支出**: 食費、光熱費など（負の値として保存）
- **繰越**: 前月からの繰越金（負の値として保存）

### 担当者管理

各データには担当者（`husband` または `wife`）を設定できます。

```typescript
type Person = 'husband' | 'wife'
```

### CRUD操作

- 新規作成（Create）
- 一覧表示（Read）
- 編集（Update）
- 削除（Delete）

## 2. 自動精算計算

収支データから自動的に精算金額を計算します。

### 計算ロジック

```
収入合計 = SUM(全収入)
支出合計 = SUM(全支出)  ※負の値

お小遣い = (収入合計 + 支出合計) / 2

夫の合計 = 夫の収入 + 夫の支出 + 夫の繰越
妻の合計 = 妻の収入 + 妻の支出 + 妻の繰越

精算額 = 夫の合計 - お小遣い
```

### 精算結果の解釈

| 精算額 | 意味 |
|-------|------|
| 正の値 | 夫から妻へ支払い |
| 負の値 | 妻から夫へ支払い |
| 0 | 精算不要 |

### 計算例

```
夫の収入: 300,000円
妻の収入: 200,000円
支出合計: -400,000円

収入合計 = 500,000円
お小遣い = (500,000 - 400,000) / 2 = 50,000円

夫の合計 = 300,000 - 200,000(夫の支出分) = 100,000円
精算額 = 100,000 - 50,000 = 50,000円

→ 夫から妻へ50,000円支払い
```

## 3. 月データコピー機能

前月のデータを当月にコピーする機能です。

### コピーモード

| モード | 説明 |
|-------|------|
| `add` | 既存データとマージ（追加） |
| `skip` | 重複する項目名はスキップ |
| `replace` | 既存データを削除して置換 |

### アイテムコピーモード

| モード | 説明 |
|-------|------|
| `withAmount` | 金額付きでコピー |
| `labelOnly` | 項目名のみコピー（金額は最小値1円） |

### コピー対象

- 収入データ
- 支出データ
- 繰越データ（オプション：一括コピー可能）

## 4. 認証機能

### ログイン方式

パスワード認証（bcryptによるハッシュ化）

### セッション管理

| 項目 | 値 |
|-----|---|
| Cookie名 | `household_session` |
| 有効期限 | 7日間 |
| 属性 | httpOnly, secure, sameSite: lax |

### パスワードハッシュの管理

以下のいずれかで管理：
- 環境変数
- Supabase設定テーブル

### 認証フロー

```
1. ユーザーがパスワードを入力
2. bcryptでハッシュと比較
3. 一致すればセッションCookieを発行
4. 以降のリクエストはCookieで認証
```

### ミドルウェアによる保護

`middleware.ts`で全ページを保護し、未認証ユーザーは `/login` にリダイレクトされます。

## 5. UI/UX機能

### 月選択・ナビゲーション

- 前月/次月への移動
- 現在選択中の月の表示

### リアルタイム計算

データ入力・編集時に即座に計算結果を更新

### トースト通知

操作結果（成功/エラー）をトースト通知で表示

### レスポンシブデザイン

Tailwind CSSによるモバイル対応レイアウト
